{"version":3,"sources":["../../../lib/utils.ts","../../../lib/DashboardMessageBus.ts","../../../lib/types.ts","../../../../lib/message/types.ts","utils/constants.ts","utils/utils.ts","components/common/NetworkIndicator.tsx","components/common/Button.tsx","components/Header/Header.tsx","components/common/Card.tsx","components/DashboardProvider/IncomingRequest.tsx","components/DashboardProvider/DashboardProvider.tsx","components/ConnectNetwork.tsx","components/ConfirmNetworkChange.tsx","Dashboard.tsx","App.tsx","index.tsx","../../../lib/index.ts"],"names":["INTERACTIVE_REQUESTS","UNSUPPORTED_REQUESTS","getPorts","a","dashboardHost","window","location","hostname","dashboardPort","Number","port","getMessageBusPorts","isInteractiveRequest","request","includes","payload","method","isUnsupportedRequest","forwardDashboardProviderRequest","provider","connector","console","debug","id","sendAsync","promisify","bind","result","connectorId","jsonrpc","error","handleDashboardProviderRequest","responseSocket","responsePayload","response","respond","socket","encodedResponse","jsonToBase64","send","getNetworkName","chainId","axios","get","chainList","data","filter","chain","name","getDisplayName","address","reverseLookup","ensName","shortenedAccount","shortenAddress","lookupAddress","undefined","substr","length","NetworkIndicator","useState","networkName","setNetworkName","textColor","useEffect","updateNetwork","connectedNetworkName","className","Button","onClick","text","Header","disconnect","displayName","setDisplayName","useAccount","accountData","useNetwork","networkData","useConnect","connectData","updateAccountDisplay","connected","getProvider","src","width","alt","Card","header","body","footer","headerOrNull","bodyOrNull","footerOrNull","IncomingRequest","setRequests","removeFromRequests","previousRequests","other","process","reject","errorResponse","code","message","transaction","params","messageParams","from","JSON","parse","formatDashboardProviderRequestParameters","DashboardProvider","paused","requests","forEach","defaultMessage","eth_sign","respondToUnsupportedRequest","incomingRequests","map","ConnectNetwork","confirm","connect","connectButton","connectors","confirmBody","confirmButton","ConfirmNetworkChanged","newChainId","previousChainId","Dashboard","setPaused","connectedChainId","setConnectedChainId","setChainId","setSocket","dashboardProviderRequests","setDashboardProviderRequests","initializeSocket","readyState","WebSocket","OPEN","messageBusHost","subscribePort","connectToMessageBusWithRetries","connectedSocket","addEventListener","event","toString","base64ToJson","isDashboardProviderMessage","isInvalidateMessage","log","close","ConfirmNetworkChange","defaultChain","mainnet","_config","ret","wProvider","winEth","ethereum","INFURA_ID","REACT_APP_INFURA_ID","enable","then","r","catch","e","ethproviders","Web3Provider","getDefaultProvider","getNetwork","InjectedConnector","chains","defaultChains","WalletConnectConnector","options","infuraId","qrcode","App","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.c7d442a6.chunk.js","sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getMessageBusPorts = exports.connectToMessageBus = exports.connectToMessageBusWithRetries = exports.sendAndAwait = exports.broadcastAndAwaitFirst = exports.broadcastAndDisregard = exports.createMessage = exports.startWebSocketServer = exports.base64ToJson = exports.jsonToBase64 = void 0;\nconst isomorphic_ws_1 = __importDefault(require(\"isomorphic-ws\"));\nconst promise_any_1 = __importDefault(require(\"promise.any\"));\nconst delay_1 = __importDefault(require(\"delay\"));\nconst axios_1 = __importDefault(require(\"axios\"));\npromise_any_1.default.shim();\n/**\n * Convert any JS object or value to a base64 representation of it\n */\nconst jsonToBase64 = (json) => {\n    const stringifiedJson = JSON.stringify(json);\n    const buffer = Buffer.from(stringifiedJson);\n    const base64 = buffer.toString(\"base64\");\n    return base64;\n};\nexports.jsonToBase64 = jsonToBase64;\n/**\n * Convert the base64 representation of a JS object or value to its JS representation\n * @dev This is the reverse of `jsonToBase64` and is not expected to work with other base64 formats\n */\nconst base64ToJson = (base64) => {\n    const buffer = Buffer.from(base64, \"base64\");\n    const stringifiedJson = buffer.toString(\"utf8\");\n    const json = JSON.parse(stringifiedJson);\n    return json;\n};\nexports.base64ToJson = base64ToJson;\n/**\n * Starts a websocket server and waits for it to be opened\n * @dev If you need to attach event listeners *before* the server connection opens,\n * do not use this function since it resolves *after* the connection is opened\n */\nconst startWebSocketServer = (options) => {\n    return new Promise(resolve => {\n        const server = new isomorphic_ws_1.default.Server(options, () => resolve(server));\n    });\n};\nexports.startWebSocketServer = startWebSocketServer;\nconst createMessage = (type, payload) => {\n    const id = Math.random();\n    return { id, type, payload };\n};\nexports.createMessage = createMessage;\n/**\n * Broadcast a message to multiple websocket connections and disregard them\n */\nconst broadcastAndDisregard = (sockets, message) => {\n    const encodedMessage = exports.jsonToBase64(message);\n    sockets.forEach(socket => {\n        socket.send(encodedMessage);\n    });\n};\nexports.broadcastAndDisregard = broadcastAndDisregard;\n/**\n * Broadcast a message to multuple websocket connections and return the first response\n */\nconst broadcastAndAwaitFirst = (sockets, message) => __awaiter(void 0, void 0, void 0, function* () {\n    const promises = sockets.map(socket => exports.sendAndAwait(socket, message));\n    const result = yield Promise.any(promises);\n    return result;\n});\nexports.broadcastAndAwaitFirst = broadcastAndAwaitFirst;\n/**\n * Send a message to a websocket connection and await a matching response\n * @dev Responses are matched by looking at received messages that match the ID of the sent message\n */\nconst sendAndAwait = (socket, message) => {\n    return new Promise((resolve, reject) => {\n        socket.addEventListener(\"message\", (event) => {\n            if (typeof event.data !== \"string\") {\n                event.data = event.data.toString();\n            }\n            const response = exports.base64ToJson(event.data);\n            if (response.id !== message.id)\n                return;\n            resolve(response);\n        });\n        // TODO: Need to check that the error corresponds to the sent message?\n        socket.addEventListener(\"error\", (event) => {\n            reject(event.error);\n        });\n        socket.addEventListener(\"close\", (event) => {\n            reject(new Error(`Socket connection closed with code '${event.code}' and reason '${event.reason}'`));\n        });\n        const encodedMessage = exports.jsonToBase64(message);\n        socket.send(encodedMessage);\n    });\n};\nexports.sendAndAwait = sendAndAwait;\nconst connectToMessageBusWithRetries = (port, host = \"localhost\", retries = 50) => __awaiter(void 0, void 0, void 0, function* () {\n    let error = new Error();\n    for (let tryCount = 0; tryCount < retries; tryCount += 1) {\n        try {\n            return yield exports.connectToMessageBus(port, host);\n        }\n        catch (e) {\n            error = e;\n            yield delay_1.default(1000);\n        }\n    }\n    throw error;\n});\nexports.connectToMessageBusWithRetries = connectToMessageBusWithRetries;\nconst connectToMessageBus = (port, host = \"localhost\") => {\n    const socket = new isomorphic_ws_1.default(`ws://${host}:${port}`);\n    return new Promise((resolve, reject) => {\n        socket.addEventListener(\"open\", () => resolve(socket));\n        socket.addEventListener(\"error\", (event) => reject(event.error));\n    });\n};\nexports.connectToMessageBus = connectToMessageBus;\nconst getMessageBusPorts = (dashboardPort, dashboardHost = \"localhost\", retries = 5) => __awaiter(void 0, void 0, void 0, function* () {\n    for (let tryCount = 0; tryCount < retries; tryCount += 1) {\n        try {\n            const { data } = yield axios_1.default.get(`http://${dashboardHost}:${dashboardPort}/ports`);\n            return data;\n        }\n        catch (e) {\n            yield delay_1.default(1000);\n        }\n    }\n    throw new Error(`Could not connect to dashboard at http://${dashboardHost}:${dashboardPort}/ports`);\n});\nexports.getMessageBusPorts = getMessageBusPorts;\n//# sourceMappingURL=utils.js.map","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.DashboardMessageBus = void 0;\nconst delay_1 = __importDefault(require(\"delay\"));\nconst events_1 = require(\"events\");\nconst utils_1 = require(\"./utils\");\nconst util_1 = require(\"util\");\nclass DashboardMessageBus extends events_1.EventEmitter {\n    constructor(publishPort, subscribePort, host = \"localhost\") {\n        super();\n        this.publishPort = publishPort;\n        this.subscribePort = subscribePort;\n        this.host = host;\n        this.publishers = [];\n        this.subscribers = [];\n        this.unfulfilledRequests = new Map([]);\n    }\n    /**\n     * Start the DashboardMessageBus\n     * @dev This starts separate websocket servers for subscribers/publishers\n     */\n    start() {\n        return __awaiter(this, void 0, void 0, function* () {\n            this.subscribeServer = yield utils_1.startWebSocketServer({\n                host: this.host,\n                port: this.subscribePort\n            });\n            this.subscribeServer.on(\"connection\", (newSubscriber) => {\n                newSubscriber.on(\"close\", () => {\n                    this.removeSubscriber(newSubscriber);\n                });\n                // Require the subscriber to send a message *first* before being added\n                newSubscriber.once(\"message\", () => this.addSubscriber(newSubscriber));\n            });\n            this.publishServer = yield utils_1.startWebSocketServer({\n                host: this.host,\n                port: this.publishPort\n            });\n            this.publishServer.on(\"connection\", (newPublisher) => {\n                newPublisher.on(\"close\", () => {\n                    this.removePublisher(newPublisher);\n                });\n                this.addPublisher(newPublisher);\n            });\n        });\n    }\n    /**\n     * Wait for the message bus to be \"ready\" to process requests (i.e. having any subscribers).\n     * @dev Polls every second to see if the number of subscribers > 0\n     */\n    ready() {\n        return __awaiter(this, void 0, void 0, function* () {\n            while (this.subscribers.length === 0) {\n                yield delay_1.default(1000);\n            }\n        });\n    }\n    /**\n     * Close both websocket servers\n     * @dev Emits a \"terminate\" event\n     */\n    terminate() {\n        return __awaiter(this, void 0, void 0, function* () {\n            yield util_1.promisify(this.publishServer.close.bind(this.publishServer))();\n            yield util_1.promisify(this.subscribeServer.close.bind(this.subscribeServer))();\n            this.emit(\"terminate\");\n        });\n    }\n    /**\n     * Process a message `data` coming from `publisher` by sending it to `subscribers`\n     * and return the first received response to the `publisher`\n     */\n    processRequest(publisher, data, subscribers) {\n        return __awaiter(this, void 0, void 0, function* () {\n            // convert to string for uniformity since WebSocket.Data can take other forms\n            if (typeof data !== \"string\") {\n                data = data.toString();\n            }\n            yield this.ready();\n            this.unfulfilledRequests.set(data, { publisher, data });\n            const message = utils_1.base64ToJson(data);\n            try {\n                this.logToPublishers(`Sending message to ${subscribers.length} subscribers`, \"requests\");\n                this.logToPublishers(message, \"requests\");\n                const response = yield utils_1.broadcastAndAwaitFirst(subscribers, message);\n                this.logToPublishers(`Sending response for message ${message.id}`, \"responses\");\n                this.logToPublishers(response, \"responses\");\n                const encodedResponse = utils_1.jsonToBase64(response);\n                publisher.send(encodedResponse);\n                this.unfulfilledRequests.delete(data);\n                this.invalidateMessage(message.id);\n            }\n            catch (error) {\n                this.logToPublishers(`An error occurred while processing message ${message.id}`, \"errors\");\n                this.logToPublishers(error, \"errors\");\n            }\n        });\n    }\n    invalidateMessage(id) {\n        const invalidationMessage = utils_1.createMessage(\"invalidate\", id);\n        utils_1.broadcastAndDisregard(this.subscribers, invalidationMessage);\n    }\n    logToPublishers(logMessage, namespace) {\n        this.logTo(logMessage, this.publishers, namespace);\n    }\n    logToSubscribers(logMessage, namespace) {\n        this.logTo(logMessage, this.subscribers, namespace);\n    }\n    logToAll(logMessage, namespace) {\n        this.logToPublishers(logMessage, namespace);\n        this.logToSubscribers(logMessage, namespace);\n    }\n    logTo(logMessage, receivers, namespace) {\n        const payload = {\n            namespace: \"dashboard-message-bus\",\n            message: logMessage\n        };\n        if (namespace) {\n            payload.namespace += `:${namespace}`;\n        }\n        const message = utils_1.createMessage(\"log\", payload);\n        utils_1.broadcastAndDisregard(receivers, message);\n    }\n    /**\n     * Add a publisher so it can be used to send requests to\n     * @dev Also sends all backlogged (unfulfilled) requests upon connection\n     */\n    addSubscriber(newSubscriber) {\n        this.unfulfilledRequests.forEach(({ publisher, data }) => this.processRequest(publisher, data, [newSubscriber]));\n        this.logToPublishers(\"Subscriber connected\", \"connections\");\n        this.subscribers.push(newSubscriber);\n    }\n    /**\n     * Remove a subscriber\n     * @dev Will cause the server to terminate if this was the last connection\n     */\n    removeSubscriber(subscriberToRemove) {\n        this.logToPublishers(\"Subscriber disconnected\", \"connections\");\n        this.subscribers = this.subscribers.filter(subscriber => subscriber !== subscriberToRemove);\n        this.terminateIfNoConnections();\n    }\n    /**\n     * Add a publisher and set up message listeners to process their requests\n     */\n    addPublisher(newPublisher) {\n        this.logToPublishers(\"Publisher connected\", \"connections\");\n        newPublisher.on(\"message\", (data) => {\n            this.processRequest(newPublisher, data, this.subscribers);\n        });\n        this.publishers.push(newPublisher);\n    }\n    /**\n     * Remove a publisher and their corresponding requests\n     * @dev Will cause the server to terminate if this was the last connection\n     */\n    removePublisher(publisherToRemove) {\n        this.logToPublishers(\"Publisher disconnected\", \"connections\");\n        this.publishers = this.publishers.filter(publisher => publisher !== publisherToRemove);\n        this.clearRequestsForPublisher(publisherToRemove);\n        this.terminateIfNoConnections();\n    }\n    terminateIfNoConnections() {\n        if (this.publishers.length === 0 && this.subscribers.length === 0) {\n            this.terminate();\n        }\n    }\n    clearRequestsForPublisher(publisher) {\n        this.unfulfilledRequests.forEach(({ publisher: requestPublisher }, key) => {\n            if (requestPublisher === publisher) {\n                this.unfulfilledRequests.delete(key);\n            }\n        });\n    }\n}\nexports.DashboardMessageBus = DashboardMessageBus;\n//# sourceMappingURL=DashboardMessageBus.js.map","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__exportStar(require(\"./message/types\"), exports);\n//# sourceMappingURL=types.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.isInvalidateMessage = exports.isLogMessage = exports.isDashboardProviderMessage = void 0;\nconst isDashboardProviderMessage = (message) => {\n    return message.type === \"provider\";\n};\nexports.isDashboardProviderMessage = isDashboardProviderMessage;\nconst isLogMessage = (message) => {\n    return message.type === \"log\";\n};\nexports.isLogMessage = isLogMessage;\nconst isInvalidateMessage = (message) => {\n    return message.type === \"invalidate\";\n};\nexports.isInvalidateMessage = isInvalidateMessage;\n//# sourceMappingURL=types.js.map","export const INTERACTIVE_REQUESTS = [\n  \"eth_signTransaction\",\n  \"eth_sendTransaction\",\n  \"eth_decrypt\",\n  \"eth_signTypedData\",\n  \"eth_signTypedData_v1\",\n  \"eth_signTypedData_v3\",\n  \"eth_signTypedData_v4\",\n  \"personal_sign\"\n];\n\nexport const UNSUPPORTED_REQUESTS = [\"eth_sign\"];\n","import WebSocket from \"isomorphic-ws\";\nimport {\n  DashboardProviderMessage,\n  getMessageBusPorts,\n  jsonToBase64,\n  PortsConfig\n} from \"@truffle/dashboard-message-bus\";\nimport axios from \"axios\";\nimport { providers } from \"ethers\";\nimport type { JSONRPCRequestPayload } from \"ethereum-protocol\";\nimport { promisify } from \"util\";\nimport { INTERACTIVE_REQUESTS, UNSUPPORTED_REQUESTS } from \"./constants\";\n\nexport const getPorts = async (): Promise<PortsConfig> => {\n  const dashboardHost = window.location.hostname;\n  const dashboardPort =\n    process.env.NODE_ENV === \"development\"\n      ? 24012\n      : Number(window.location.port);\n  return getMessageBusPorts(dashboardPort, dashboardHost);\n};\n\nexport const isInteractiveRequest = (request: DashboardProviderMessage) =>\n  INTERACTIVE_REQUESTS.includes(request.payload.method);\n\nexport const isUnsupportedRequest = (request: DashboardProviderMessage) =>\n  UNSUPPORTED_REQUESTS.includes(request.payload.method);\n\nexport const forwardDashboardProviderRequest = async (\n  provider: any,\n  connector: any,\n  payload: JSONRPCRequestPayload\n) => {\n  console.debug(\"forwardDashboardProviderRequest:input\", {\n    id: payload.id,\n    provider,\n    connector,\n    payload\n  });\n  const sendAsync = promisify(provider.sendAsync.bind(provider));\n  try {\n    let result = await sendAsync(payload);\n    let connectorId: string | undefined = connector?.id;\n    console.debug(\"forwardDashboardProviderRequest:result\", {\n      id: payload.id,\n      payload,\n      result\n    });\n    if (connectorId === \"injected\") {\n      // we should get full RPC json payloads returned.\n      return result;\n    } else {\n      // we may just get the result object itself, no RPC wrapper.\n      return {\n        jsonrpc: payload.jsonrpc,\n        id: payload.id,\n        result\n      };\n    }\n  } catch (error) {\n    console.error(error);\n    return {\n      jsonrpc: payload.jsonrpc,\n      id: payload.id,\n      error\n    };\n  }\n};\n\nexport const handleDashboardProviderRequest = async (\n  request: DashboardProviderMessage,\n  provider: any,\n  connector: any,\n  responseSocket: WebSocket\n) => {\n  const responsePayload = await forwardDashboardProviderRequest(\n    provider,\n    connector,\n    request.payload\n  );\n  const response = {\n    id: request.id,\n    payload: responsePayload\n  };\n  respond(response, responseSocket);\n};\n\nexport const respondToUnsupportedRequest = (\n  request: DashboardProviderMessage,\n  responseSocket: WebSocket\n) => {\n  const defaultMessage = `Method \"${request.payload.method}\" is unsupported by @truffle/dashboard-provider`;\n  const customMessages: { [index: string]: string } = {\n    eth_sign:\n      'Method \"eth_sign\" is unsupported by @truffle/dashboard-provider, please use \"personal_sign\" instead'\n  };\n\n  const message = customMessages[request.payload.method] ?? defaultMessage;\n  const code = 4001;\n\n  const errorResponse = {\n    id: request.id,\n    payload: {\n      jsonrpc: request.payload.jsonrpc,\n      id: request.payload.id,\n      error: { code, message }\n    }\n  };\n\n  respond(errorResponse, responseSocket);\n};\n\nexport const respond = (response: any, socket: WebSocket) => {\n  console.debug(\"Sending response\", response);\n  const encodedResponse = jsonToBase64(response);\n  socket.send(encodedResponse);\n};\n\nexport const getNetworkName = async (chainId: number) => {\n  const { data: chainList } = await axios.get(\n    \"https://chainid.network/chains.json\"\n  );\n  const [chain] = chainList.filter((chain: any) => chain.chainId === chainId);\n  if (!chain) return `Chain ID ${chainId}`;\n  return chain.name;\n};\n\nexport const getDisplayName = async (\n  provider: providers.BaseProvider,\n  address: string\n) => {\n  const ensName = await reverseLookup(provider, address);\n  const shortenedAccount = shortenAddress(address);\n  return ensName ?? shortenedAccount;\n};\n\nexport const reverseLookup = async (\n  provider: providers.BaseProvider,\n  address: string\n) => {\n  try {\n    return await provider.lookupAddress(address);\n  } catch {\n    return undefined;\n  }\n};\n\nexport const shortenAddress = (address: string) => {\n  return `${address.substr(0, 6)}...${address.substr(address.length - 4, 4)}`;\n};\n","import {useEffect, useState} from \"react\";\nimport {getNetworkName} from \"src/utils/utils\";\n\ninterface Props {\n  chainId: number;\n}\n\nfunction NetworkIndicator({chainId}: Props) {\n  const [networkName, setNetworkName] = useState<string>(`Chain ID ${chainId}`);\n  const textColor = chainId === 1 ? \"text-truffle-red\" : \"\";\n\n  useEffect(() => {\n    const updateNetwork = async (chainId: number) => {\n      const connectedNetworkName = await getNetworkName(chainId);\n      setNetworkName(connectedNetworkName);\n    };\n\n    if (!chainId) return;\n    updateNetwork(chainId);\n  }, [chainId]);\n\n  return <div className={`rounded uppercase ${textColor}`}>{networkName}</div>;\n}\n\nexport default NetworkIndicator;\n","import type { MouseEventHandler } from \"react\";\n\ninterface Props {\n  onClick: MouseEventHandler<HTMLElement>;\n  text: string;\n}\n\nfunction Button({ onClick, text }: Props) {\n  return (\n    <button\n      className=\"rounded p-4 mx-2 bg-truffle-blue text-truffle-brown uppercase hover:bg-white\"\n      onClick={onClick}\n    >\n      {text}\n    </button>\n  );\n}\n\nexport default Button;\n","import { providers } from \"ethers\";\nimport { useEffect, useState } from \"react\";\nimport { getDisplayName } from \"../../utils/utils\";\nimport NetworkIndicator from \"../common/NetworkIndicator\";\nimport {useAccount, useConnect, useNetwork} from \"wagmi\";\nimport Button from \"../common/Button\";\n\ninterface Props {\n  disconnect: () => void;\n}\n\nfunction Header({disconnect}: Props) {\n  const [displayName, setDisplayName] = useState<string>();\n\n  const [{ data: accountData}] = useAccount();\n  const [{ data: networkData }] = useNetwork();\n  const [{data: connectData}] = useConnect();\n\n  useEffect(() => {\n    const updateAccountDisplay = async (\n      provider: providers.Web3Provider,\n      address: string\n    ) => {\n      setDisplayName(await getDisplayName(provider, address));\n    };\n\n    if(!connectData.connected) {\n      setDisplayName(undefined);\n    }\n\n    if (!connectData || !accountData) return;\n    updateAccountDisplay(connectData.connector?.getProvider(), accountData.address);\n  }, [connectData, accountData]);\n\n\n  return (\n    <header className=\"grid grid-cols-2 py-2 px-4 border-b-2 border-truffle-light text-md uppercase\">\n      <div className=\"flex justify-start items-center\">\n        <span className=\"inline-flex items-center gap-3\">\n          <img src={\"/truffle-logomark.svg\"} width=\"32px\" alt={'Truffle Logo'}/>\n          Truffle Dashboard\n        </span>\n      </div>\n      <div className=\"flex justify-end items-center gap-4 text-md\">\n        {networkData.chain?.id && <NetworkIndicator chainId={networkData.chain.id} />}\n        {networkData.chain?.id && <Button onClick={disconnect} text={'disconnect'}/>}\n        <div>{displayName}</div>\n      </div>\n    </header>\n  );\n}\n\nexport default Header;\n","import type { ReactNode } from \"react\";\n\ninterface Props {\n  header?: string | ReactNode;\n  body?: string | ReactNode | ReactNode[];\n  footer?: string | ReactNode;\n}\n\nfunction Card({ header, body, footer }: Props) {\n  const headerOrNull = header && (\n    <div className=\"border-b border-grey py-3 mx-3\">\n      <h2 className=\"text-center uppercase\">{header}</h2>\n    </div>\n  );\n\n  const bodyOrNull = body && <div className=\"p-3 overflow-auto\">{body}</div>;\n\n  const footerOrNull = footer && (\n    <div className=\"border-t border-grey py-3 mx-3\">{footer}</div>\n  );\n\n  return (\n    <div className=\"border-grey border rounded bg-white w-full\">\n      {headerOrNull}\n      {bodyOrNull}\n      {footerOrNull}\n    </div>\n  );\n}\n\nexport default Card;\n","import WebSocket from \"isomorphic-ws\";\nimport ReactJson from \"react-json-view\";\nimport { handleDashboardProviderRequest, respond } from \"../../utils/utils\";\nimport Button from \"../common/Button\";\nimport Card from \"../common/Card\";\nimport { DashboardProviderMessage } from \"@truffle/dashboard-message-bus\";\n\ninterface Props {\n  request: DashboardProviderMessage;\n  setRequests: (\n    requests:\n      | DashboardProviderMessage[]\n      | ((requests: DashboardProviderMessage[]) => DashboardProviderMessage[])\n  ) => void;\n  provider: any;\n  connector: any;\n  socket: WebSocket;\n}\n\nfunction IncomingRequest({ provider, connector, socket, request, setRequests }: Props) {\n  const removeFromRequests = () => {\n    setRequests(previousRequests =>\n      previousRequests.filter(other => other.id !== request.id)\n    );\n  };\n\n  const process = async () => {\n    await handleDashboardProviderRequest(request, provider, connector, socket);\n    removeFromRequests();\n  };\n\n  const reject = async () => {\n    const errorResponse = {\n      id: request.id,\n      payload: {\n        jsonrpc: request.payload.jsonrpc,\n        id: request.payload.id,\n        error: {\n          code: 4001,\n          message: \"User rejected @truffle/dashboard-provider request\"\n        }\n      }\n    };\n\n    respond(errorResponse, socket);\n    removeFromRequests();\n  };\n\n  const formatDashboardProviderRequestParameters = (\n    request: DashboardProviderMessage\n  ) => {\n    switch (request.payload.method) {\n      case \"eth_sendTransaction\":\n      case \"eth_signTransaction\": {\n        const [transaction] = request.payload.params;\n        return <ReactJson name=\"transaction\" src={transaction as any} />;\n      }\n      case \"eth_signTypedData_v1\":\n      case \"eth_signTypedData\": {\n        const [messageParams, from] = request.payload.params;\n        return (\n          <div>\n            <div>Account: {from}</div>\n            <div className=\"flex gap-2\">\n              <div>Message:</div>\n              <ReactJson name=\"message params\" src={messageParams} />\n            </div>\n          </div>\n        );\n      }\n      case \"eth_signTypedData_v3\":\n      case \"eth_signTypedData_v4\": {\n        const [from, messageParams] = request.payload.params;\n        const { message } = JSON.parse(messageParams);\n        return (\n          <div>\n            <div>Account: {from}</div>\n            <div className=\"flex gap-2\">\n              <div>Message:</div>\n              <ReactJson name=\"message\" src={message} />\n            </div>\n          </div>\n        );\n      }\n      case \"personal_sign\": {\n        const [message, from] = request.payload.params;\n        return (\n          <div>\n            <div>Account: {from}</div>\n            <div className=\"flex gap-2\">\n              <div>Message:</div>\n              <div>{message}</div>\n            </div>\n          </div>\n        );\n      }\n      case \"eth_decrypt\":\n      default: {\n        return <ReactJson src={request.payload.params} />;\n      }\n    }\n  };\n\n  const header = <div className=\"normal-case\">{request.payload.method}</div>;\n\n  const body = <div>{formatDashboardProviderRequestParameters(request)}</div>;\n\n  const footer = (\n    <div className=\"flex justify-start items-center gap-2\">\n      <Button onClick={process} text=\"Process\" />\n      <Button onClick={reject} text=\"Reject\" />\n    </div>\n  );\n\n  return (\n    <div key={request.id} className=\"flex justify-center items-center\">\n      <Card header={header} body={body} footer={footer} />\n    </div>\n  );\n}\n\nexport default IncomingRequest;\n","import WebSocket from \"isomorphic-ws\";\nimport {useEffect} from \"react\";\nimport {\n  handleDashboardProviderRequest,\n  isInteractiveRequest,\n  isUnsupportedRequest,\n  respondToUnsupportedRequest\n} from \"../../utils/utils\";\nimport Card from \"../common/Card\";\nimport IncomingRequest from \"./IncomingRequest\";\nimport type {DashboardProviderMessage} from \"@truffle/dashboard-message-bus\";\nimport {useConnect} from \"wagmi\";\n\ninterface Props {\n  paused: boolean;\n  requests: DashboardProviderMessage[];\n  setRequests: (\n    requests:\n      | DashboardProviderMessage[]\n      | ((requests: DashboardProviderMessage[]) => DashboardProviderMessage[])\n  ) => void;\n  socket: WebSocket;\n}\n\nfunction DashboardProvider({paused, socket, requests, setRequests}: Props) {\n  const [{data: connectData}] = useConnect();\n  const provider = connectData.connector?.getProvider();\n  const connector = connectData.connector;\n\n  useEffect(() => {\n    const removeFromRequests = (id: number) => {\n      setRequests(previousRequests =>\n        previousRequests.filter(request => request.id !== id)\n      );\n    };\n\n    if (!connectData.connected || !provider) return;\n    if (paused) return;\n\n    // Automatically respond with an error for unsupported requests\n    requests.filter(isUnsupportedRequest).forEach(request => {\n      respondToUnsupportedRequest(request, socket);\n      removeFromRequests(request.id);\n    });\n\n    // Automatically handle all non-interactive requests\n    requests\n      .filter(\n        request =>\n          !isInteractiveRequest(request) && !isUnsupportedRequest(request)\n      )\n      .forEach(request => {\n        handleDashboardProviderRequest(request, provider, connector, socket);\n        removeFromRequests(request.id);\n      });\n  }, [paused, requests, setRequests, socket, connectData, provider, connector]);\n\n  const incomingRequests =\n    connectData.connected && provider && socket\n      ? requests\n        .filter(isInteractiveRequest)\n        .map(request => (\n          <IncomingRequest\n            key={request.id}\n            request={request}\n            setRequests={setRequests}\n            provider={provider}\n            connector={connector}\n            socket={socket}\n          />\n        ))\n      : [];\n\n  return (\n    <div className=\"flex justify-center items-center py-20\">\n      <div className=\"mx-3 w-3/4 max-w-4xl h-2/3\">\n        <Card header=\"Incoming Requests\" body={incomingRequests}/>\n      </div>\n    </div>\n  );\n}\n\nexport default DashboardProvider;\n","import Card from \"./common/Card\";\nimport Button from \"./common/Button\";\nimport NetworkIndicator from \"./common/NetworkIndicator\";\nimport {useConnect, useNetwork} from \"wagmi\";\n\ninterface Props {\n  confirm: () => void;\n}\n\nfunction ConnectNetwork({confirm}: Props) {\n\n  const [{data: connectData}, connect] = useConnect();\n  const [{data: networkData,}] = useNetwork();\n\n  const chainId = networkData.chain?.id;\n  const connectBody =\n    \"Please connect your wallet to use the Truffle Dashboard Provider.\";\n\n  const connectButton = (\n    <div>\n      {connectData.connectors.map((connector) => (\n        <Button\n          key={connector.id}\n          onClick={() => connect(connector)}\n          text={connector.name}\n        />\n      ))\n      }\n    </div>\n  );\n\n  const confirmBody = chainId && (\n    <div className=\"flex flex-col gap-2\">\n      <div>\n        Please confirm you're connected to the right network (or switch to the\n        right one) before continuing.\n      </div>\n      <div className=\"flex justify-center\">\n        <NetworkIndicator chainId={chainId}/>\n      </div>\n    </div>\n  );\n  const confirmButton = <Button text=\"Confirm\" onClick={confirm}/>;\n  return (\n    <div className=\"flex justify-center items-center py-20\">\n      <div className=\"mx-3 w-3/4 max-w-4xl h-2/3 text-center\">\n        {chainId === undefined ? (\n          <Card\n            header=\"Connect Wallet\"\n            body={connectBody}\n            footer={connectButton}\n          />\n        ) : (\n          <Card\n            header=\"Connect Wallet\"\n            body={confirmBody}\n            footer={confirmButton}\n          />\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport default ConnectNetwork;\n","import Card from \"./common/Card\";\nimport Button from \"./common/Button\";\nimport NetworkIndicator from \"./common/NetworkIndicator\";\n\ninterface Props {\n  confirm: () => void;\n  newChainId: number;\n  previousChainId: number;\n}\n\nfunction ConfirmNetworkChanged({\n  confirm,\n  newChainId,\n  previousChainId\n}: Props) {\n  const confirmBody = (\n    <div className=\"flex flex-col gap-2\">\n      <div>\n        We detected that your connected network changed. Please confirm that\n        this was your intention or switch back to the previous network.\n      </div>\n      <div>Your previous connected network was:</div>\n      <div className=\"flex justify-center\">\n        <NetworkIndicator chainId={previousChainId} />\n      </div>\n      <div>Your new connected network is:</div>\n      <div className=\"flex justify-center\">\n        <NetworkIndicator chainId={newChainId} />\n      </div>\n    </div>\n  );\n\n  const confirmButton = <Button text=\"Confirm\" onClick={confirm} />;\n\n  return (\n    <div className=\"flex justify-center items-center py-20\">\n      <div className=\"mx-3 w-3/4 max-w-4xl h-2/3 text-center\">\n        <Card\n          header=\"Confirm Network Changed\"\n          body={confirmBody}\n          footer={confirmButton}\n        />\n      </div>\n    </div>\n  );\n}\n\nexport default ConfirmNetworkChanged;\n","import WebSocket from \"isomorphic-ws\";\nimport {\n  DashboardProviderMessage,\n  connectToMessageBusWithRetries,\n  isDashboardProviderMessage,\n  isInvalidateMessage,\n  Message,\n  base64ToJson\n} from \"@truffle/dashboard-message-bus\";\nimport {useEffect, useState} from \"react\";\nimport {getPorts} from \"./utils/utils\";\nimport Header from \"./components/Header/Header\";\nimport DashboardProvider from \"./components/DashboardProvider/DashboardProvider\";\nimport ConnectNetwork from \"./components/ConnectNetwork\";\nimport ConfirmNetworkChanged from \"./components/ConfirmNetworkChange\";\nimport {useAccount, useConnect, useNetwork} from \"wagmi\";\n\nfunction Dashboard() {\n  const [paused, setPaused] = useState<boolean>(false);\n  const [connectedChainId, setConnectedChainId] = useState<number | undefined>();\n  const [chainId, setChainId] = useState<number>();\n  const [socket, setSocket] = useState<WebSocket | undefined>();\n  const [dashboardProviderRequests, setDashboardProviderRequests] = useState<DashboardProviderMessage[]>([]);\n\n  const [{data}] = useNetwork();\n  const [{}, disconnect] = useAccount();\n  const [{data: connectData}] = useConnect();\n\n\n  useEffect(() => {\n    setChainId(data.chain?.id);\n\n    if (!chainId || !socket) return;\n    if (connectedChainId) {\n      if (connectedChainId !== chainId) setPaused(true);\n      if (connectedChainId === chainId) setPaused(false);\n    } else {\n      setConnectedChainId(chainId);\n    }\n  }, [data, connectData, socket, chainId, connectedChainId]);\n\n  const initializeSocket = async () => {\n    if (socket && socket.readyState === WebSocket.OPEN) return;\n\n    const messageBusHost = window.location.hostname;\n    const {subscribePort} = await getPorts();\n    const connectedSocket = await connectToMessageBusWithRetries(\n      subscribePort,\n      messageBusHost\n    );\n\n    connectedSocket.addEventListener(\n      \"message\",\n      (event: WebSocket.MessageEvent) => {\n        if (typeof event.data !== \"string\") {\n          event.data = event.data.toString();\n        }\n\n        const message = base64ToJson(event.data) as Message;\n\n        console.debug(\"Received message\", message);\n\n        if (isDashboardProviderMessage(message)) {\n          setDashboardProviderRequests(previousRequests => [\n            ...previousRequests,\n            message\n          ]);\n        } else if (isInvalidateMessage(message)) {\n          setDashboardProviderRequests(previousRequests =>\n            previousRequests.filter(request => request.id !== message.payload)\n          );\n        }\n      }\n    );\n\n    connectedSocket.send(\"ready\");\n\n    setSocket(connectedSocket);\n  };\n\n  const disconnectAccount = () => {\n    console.log(\"Disconnecting:\");\n    // turn everything off.\n    disconnect();\n    setConnectedChainId(undefined);\n    setPaused(false);\n    socket?.close();\n    setSocket(undefined);\n  };\n\n  return (\n    <div className=\"h-full min-h-screen bg-gradient-to-b from-truffle-lighter to-truffle-light\">\n      <Header disconnect={disconnectAccount}/>\n      {paused && chainId && connectedChainId && (\n        <ConfirmNetworkChanged\n          newChainId={chainId}\n          previousChainId={connectedChainId}\n          confirm={() => setConnectedChainId(chainId)}\n        />\n      )}\n      {!paused && !socket && <ConnectNetwork confirm={initializeSocket}/>}\n      {!paused && socket && (\n        <DashboardProvider\n          paused={paused}\n          socket={socket}\n          requests={dashboardProviderRequests}\n          setRequests={setDashboardProviderRequests}\n        />\n      )}\n    </div>\n  );\n}\n\nexport default Dashboard;\n","import Dashboard from \"./Dashboard\";\n\nimport {Provider, chain, defaultChains, Connector} from 'wagmi';\nimport {InjectedConnector} from 'wagmi/connectors/injected';\nimport {WalletConnectConnector} from 'wagmi/connectors/walletConnect';\n\nimport {getDefaultProvider, providers as ethproviders} from \"ethers\";\nimport {getNetwork} from \"@ethersproject/providers\";\n\nconst defaultChain = chain.mainnet;\n\nconst getProvider = (_config: { chainId?: number; connector?: Connector }) => {\n  let wProvider = _config.connector?.getProvider(true);\n  console.debug(\"getProvider\", {wProvider, winEth: window.ethereum, _config, INFURA_ID: process.env.REACT_APP_INFURA_ID});\n  let ret: any;\n  if (!wProvider) {\n    ret = getDefaultProvider(getNetwork(_config.chainId ?? defaultChain.id));\n  } else {\n    wProvider.enable()\n      .then((r: any) => console.debug(r))\n      .catch((e: any) => console.error(e));\n    ret = new ethproviders.Web3Provider(wProvider);\n  }\n  console.debug(\"getProvider.returning\", {wProvider, winEth: window.ethereum, ret});\n  return ret;\n};\n\nconst connectors = [\n  new InjectedConnector({chains: defaultChains}),\n  new WalletConnectConnector({\n    chains: defaultChains,\n    options: {\n      infuraId: process.env.REACT_APP_INFURA_ID,\n      qrcode: true,\n    },\n  }),\n];\n\nfunction App() {\n  return (\n    <Provider connectors={connectors} provider={getProvider}>\n      <Dashboard/>\n    </Provider>\n  );\n}\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\nimport \"./index.css\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__exportStar(require(\"./DashboardMessageBus\"), exports);\n__exportStar(require(\"./utils\"), exports);\n__exportStar(require(\"./types\"), exports);\n//# sourceMappingURL=index.js.map"],"sourceRoot":""}